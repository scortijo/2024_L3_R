---
title: "Réaliser des graphiques avec ``ggplot2``"
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

[Retour à la page d'accueil](https://scortijo.github.io/2024_L3_R/)

# Visualisation de données avec ggplot2

Lors de cette séance nous allons apprendre à visualiser des jeux de données tabulaires avec [``ggplot2``](http://ggplot2.org/).

Pour cette formation, nous allons utiliser une version légèrement modifiée du jeu de données publié par [Burghard et al 2015](http://datadryad.org/resource/doi:10.5061/dryad.65d76). 

Il s'agit d'une expérience de phénotypage de plantes d'*Arabidopsis thaliana* qui ont poussé dans différentes conditions:

- A 12°C ou à 22°C
- Avec une température constante ou qui fluctue dans la journée
- Avec une période de 8h de jour ou de 16h de jour par cycle de 24h
- Avec un traitement de froid qui imite l'hiver (vernalisation)

Des plantes de différents génotypes ont été analysées: des mutants et sauvages et des écotypes différents.

Pour chaque plante dans chaque condition plusieurs phénotypes ont été mesurés (voir illustration ci-dessous pour mieux comprendre les termes):

- Le nombre de jour pour que la tige (qui contient les fleurs) émerge: _days to bolt_
- Le nombre de jour pour que la première fleur s'ouvre: _days to flower_
- Le nombre de feuilles dans la rosette à la fin de l'expérience: _rosette leaf num_
- Le nombre de feuilles caulines à la fin de l’expérience: _cauline leaf num_
- La longueur du limbe de la feuille: _blade lenght mm_
- La longueur de la feuille (avec le pétiole et le limbe) _total leaf length mm_

![](explication_data.png){width=70%} 

# Quels types de graphiques pouvons nous faire avec ggplot2?


Il est possible de représenter les données de différentes manières et ggplot2 offre de nombreuses options de visualisation.

Parmi les plus connues:

- [Des barplots](https://www.r-graph-gallery.com/barplot.html) 

- [Des boxplots](https://www.r-graph-gallery.com/boxplot.html) 

- [Des histogrammes](https://www.r-graph-gallery.com/histogram.html) 

Et encore plus. Pour toutes les découvrir, voir [cette galerie de graphiques avec ggplot2](https://www.r-graph-gallery.com/index.html)


# Mise en place


Ouvrez avec `Rstudio` le fichier `Script_ggplot_lesson.R` qui est dans le répertoire `session2_ggplot/materiel`.

Lors de cette séance nous allons utiliser plusieurs packages qui contiennent les fonctions dont nous avons besoin:  
- `tidyverse` qui contient plusieurs packages dont `ggplot2`  
- `visdat`  qui permet une représentation rapide des données  
- `plotly` pour faire des graphiques interactifs  


Ces packages sont normalement déjà installés. Pour les importer dans votre session, utilisez la fonction ``library()`` : 

```{r load packages, eval = TRUE, message = FALSE}
library(tidyverse)
library(visdat)
library(plotly)
```

Vous devez aussi vous assurer que le répertoire de travail de R est bien le dossier qui contient le matériel de la formation. Le chemin vers ce dossier va être différent en fonction de votre système opérateur.   
Pour spécifier le répertoire de travail de R utilisez la fonction ``setwd()``:

``` {r, eval = FALSE}
setwd("~/Desktop/2021_L3_R/session2_ggplot/materiel")
```


# Import et vérification des données

Ouvrez avec `Rstudio` le fichier `Script_ggplot_session.R` qui est dans le répertoire `session2_ggplot/materiel`. Nous allons coder ensemble dans ce script, qui est quasiment vide pour le moment. 


La version simplifiée des données est dans le dossier ``session2_ggplot/data`` (`burghardt_et_al_2015_expt1.txt`). Il s'agit de données pour des phénotypes associés au temps nécessaire à des plantes de différents génotypes pour fleurir dans différentes conditions.

Comme notre répertoire de travail est le dossier `materiel` , nous devons importer les données ainsi:

```{r read data}
# Import des données et chargement dans l'objet expt1 
expt1 <- read_tsv("../data/burghardt_et_al_2015_expt1.txt")
```

La fonction `read_tsv()` imprime un message indiquant quel type de données sont contenues dans les différentes colonnes du fichier. 

Dans notre cas, certaines colonnes contiennent des données de type "character" (du texte) et d'autres des données numériques ("double" en présence de décimale, "integer" en absence de décimale).


Pour regarder rapidement les données, tapez le nom de l'objet où sont les données (`expt1`).

```{r head expt1}
expt1
```

Cela va montrer les 10 premières lignes du tableau ainsi que les colonnes qui rentrent dans l'écran. 

> Combien y a-t-il de lignes et colonnes dans les données?

Une autre option est d'utiliser la fonction  ``View()`` pour accéder à une table interactive où il est possible de trier et filtrer les données sans modifier l'objet:

```{r View, eval = FALSE}
View(expt1)
```

- La fonction ``glimpse()`` permet d'avoir une idée de la structure des données:

```{r str}
glimpse(expt1)
```

> Quel est le type des variables dans les données ? 

- ``dim()`` indique les dimensions du jeu de données (nombre de lignes et colonnes).

```{r dim}
dim(expt1)
```

- Pour les données numériques, la fonction ``summary()`` permet d'obtenir des stats de base pour chaque colonne.  

```{r summary}
summary(expt1)
```

Nous avons déjà utilisé de nombreuses fonctions:

- ``install.packages()``
- ``library()``
- ``read_tsv()``
- ``View()``
- ``glimpse()``
- ``summary()``
- ``dim()``

Il est bien sûr difficile de ce souvenir du nom de toutes ces fonctions, ce qu'elles font et comment les utiliser. 
Heureusement, pour nous aider, une aide est disponible dans R en tapant le nom d'une fonction précédé de `?`

```{r get help}
?summary
```


Bien sur, une recherche sur internet est aussi une solution très efficace pour trouver de l'aide! 

>  Que fait la fonction ``head()`` ? 

>  Comment regarder les dernières lignes de le notre jeu de données? (indice: ``?tail``)


## Inspection visuelle des données

Pour avoir une vue d'ensemble du jeu de données et détecter des problèmes, nous allons utiliser la fonction  ``vis_dat()``.

```{r}
vis_dat(expt1)
```

> Quel est le type de données le plus courant dans le jeu de données ? 
Y a-t-il des problème?


## Données manquantes

Le gris dans la figure générée par ``vis_dat()`` sont des données manquantes. Plusieurs stratégies peuvent être utilisées:

- supprimer les lignes qui contiennent des données manquantes (le plus sûr, mais cause une perte de données) 
- ignorer les données manquantes


Pour la formation, nous allons enlever les lignes contenant des données manquantes.

```{r drop missing}
expt1 <- drop_na(expt1)
```

>  Combien de lignes nous reste-il? 


# Plots! Plots! Plots!

![](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/ggplot2_masterpiece.png){width=70%} 


Maintenant que nous avons vérifié la qualité de notre jeu de donnée, nous pouvons générer des graphiques afin d'en apprendre plus sur les données générées par l'expérience. 

Nous allons utiliser le package R `ggplot2`, qui utilise le principe de "grammar or graphics". Il s'agit des briques du graphique. Cette méthode permettant de combiner et superposer différentes couches de briques:

- data (données)
- aesthetics
- objet géométrique (type de graphique)
- transformations statistiques
- ajustements positionnels
- faceting

Les trois premières briques sont essentielles: data, aesthetics et objet géométrique. 

- **data** - Vos données
- **aesthetics** - Ce que l'on veux montrer sur le graphique et qui dépend des données. Par exemple ce qui est en x et y, la couleur, forme, type de ligne, taille, etc... 
Pour cela nous utilisons la fonction `aes()`. 
- **geom_objects** - les objets que nous voulons dans le graphique. Un graphique doit avoir au moins un `geom_object`, et peut en avoir plusieurs. Par exemple:
    - points (`geom_point` pour des scatter plots, dot plots)
    - lignes (`geom_line` pour des tendance, séries chronologiques)    


Pour plus d'information sur la création de graphique avec `ggplot2`, voir [cette antisèche très utile](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf).



## Faire un graphique avec ggplot2

Commençons avec un boxplot: Dessinons le `days.to.flower` pour les différents génotypes. 

La fonction `ggplot()` permet de commencer le graphique. Il faut aussi indiquer les données à utiliser:

```{r}
ggplot(expt1)
```

Mais cela ne produit qu'un canevas gris! 

Il nous manque des briques. En l’occurrence nous devons indiquer quelle _aesthetics_ (c'est la terminologie de `ggplot2`) nous voulons sur ce canevas gris. 
Nous devons indiquer quelles sont les variables  _x_ et _y_ du boxplot.

```{r}
ggplot(expt1, aes(x = genotype, y = days.to.flower))
```
 
`ggplot` indique maintenant les variables `genotype` et `days.to.flower` 
de nos données sur les axes _x_ et _y_ du graphique. 

Mais toujours pas de graphique. C'est parce que nous pas indiqué à `ggplot` quelle _géométrie_ nous voulons dessiner sur le canevas. Pour faire un boxplot, nous ajoutons au canevas (littéralement avec un `+`) ``geom_boxplot()``:

```{r}
ggplot(expt1, aes(genotype, days.to.flower)) +
  geom_boxplot()
```

> **Exercice 1:** Pouvez vous dessiner un violin plot? (indice: ``?geom_violin``)

> **BONUS** Quel autre type de géométrie pouvez vous utilisez avec des données de ce type (catégories sur l'axe x et chiffres sur l'axe y)? 
> *Aide*: Utilisez [cet arbre de décision](https://www.data-to-viz.com/) pour choisir les géométries appropriées.




<br> 

******

-------

[Retour à la page d'accueil](https://scortijo.github.io/2024_L3_R/)


